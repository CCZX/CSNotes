# 【设计模式】- 观察者模式

## 1、什么是观察者模式

观察者模式定义了**一对多**的关系，即一个发布者可以有多个订阅者，一个订阅者也可以订阅多个发布者。当发布者在状态改变发送消息的时候，所有订阅者都会接收到这个消息，这样实现了松耦合。

观察者模式可以使用在**异步编程**中。使用观察者模式**只需要订阅我们感兴趣的节点**，不必关心发布者整个过程的状态。

观察者模式和发布订阅模式很相似，但有着细微的差别，发布订阅模式有一个中间者来作为联通发布者和订阅者的桥梁，而观察者模式是发布者和订阅者直接通信。

![](./diff.jpg)

我们实现的时候不过多考虑观察者模式和发布订阅模式的区别。

## 2、实现观察者模式
1. 指定一个发布者
2. 使用一个列表存储订阅者，以便通知订阅者
3. 发布消息时循环遍历列表通知所有订阅者
```js
class Publisher {
  list = []

  on(fn) {
    this.list.push(fn)
  }

  emit(...args) {
    for(let i = 0; i <this.list.length; i++) {
      this.list[i].apply(this, args)
    }
  }
}

// 使用：
const pub = new Publisher()
pub.on(function(...data) {
  console.log(data)
})
pub.emit(1, 2)
```

## 3、常见应用场景

使用观察者模式时需要事先将所有观察者绑定到发布者身上，如果不同观察者之间存在引用关系的话在发布消息时可能存在问题。

## 4、常见问题

### 1、观察者模式和发布订阅模式区别
- 观察者模式：只有两个角色 —— 观察者 + 被观察者；是松耦合的关系；多用于单个应用内部。
- 发布订阅模式：不仅仅只有发布者和订阅者两个角色，还存在一个中间者；完全不存在耦合；更多用于跨应用的模式(cross-application pattern)，比如我们常用的消息中间件。

## 5、总结
